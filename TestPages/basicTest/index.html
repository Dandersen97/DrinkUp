<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <title>DrinkUP! - Template</title>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous">
		
	</head>	


<body>
	<!-- MAIN BODY DIV -->

    <canvas id="c" width="300px" height="300px" style="border: 1px solid black;"  ontouchstart="StartDraw(event)" ontouchend="StopDraw(event)"></canvas>
    

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
	<script src="/scripts/templateLoad.js"></script>
    <script>
        const c =  document.getElementById("c");
        
        let touching = false;
        let touchx = 150;
        let touchy = 150;
        let baseRadius = 100;
        var data = {};
        img = new Image();
        img.src = '/images/test/joystick-button.svg';

        function draw(){
            const ctx = document.getElementById("c").getContext("2d");
            ctx.globalCompositeOperation = "destination-over";
            ctx.clearRect(0, 0, 300, 300);
            ctx.beginPath();
            ctx.closePath();
            //ctx.save();
		    //tx.translate(150, 150);
		    ctx.drawImage(img
						, 50
						, 50
                        , 200, 200
						);
            
            ctx.arc(150,150,baseRadius, 0, 2 * Math.PI);
            ctx.stroke();
            ctx.closePath();
		    //ctx.translate(-150, -150);
		    //ctx.restore();

            //ctx.save();
            //ctx.translate(touchx, touchy);
            if(touching){
                ctx.arc(touchx,touchy,30, 0, 2 * Math.PI);
                ctx.stroke();
            }
            //ctx.translate(-touchx, -touchy);
            //ctx.restore();





            window.requestAnimationFrame(draw);
        }


        function Controller(e){
            console.log(e);
        }

        function StartDraw(e){
            touching = true;
            //console.log('Starting to draw');
            //console.log(e);
            //isDrawing = true;
            e.preventDefault = true;
            //var offsetX = c.getBoundingClientRect().x;
            //var offsetY = c.getBoundingClientRect().y;
        }
	
        function StopDraw(e){
            touching = false;
            e.preventDefault = false;
        }
	
	    c.addEventListener("touchmove", function (e) {
            var rect = e.target.getBoundingClientRect();
            var x = e.touches[0].clientX - rect.left; 
            var y = e.touches[0].clientY - rect.top; 
		    e.preventDefault();
		    //var offsetX = c.getBoundingClientRect().x;
		    //var offsetY = c.getBoundingClientRect().y;
            if(x > (150 + baseRadius)){
                x = 150 + baseRadius;
            }
            if(x < (150 - baseRadius)){
                x = 150 - baseRadius;
            }
            if(y > (150 + baseRadius)){
                y = 150 + baseRadius;
            }
            if(y < (150 - baseRadius)){
                y = 150 - baseRadius;
            }
            console.log((x - 150) / baseRadius);
            touchx = x;
            touchy = y;

            data = {x: x, y: y};

	    }, false);

        

        draw();
    </script>
</body>
</html>